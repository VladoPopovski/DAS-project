This is the refactored code from part 3, as per homework 4, part 1.
